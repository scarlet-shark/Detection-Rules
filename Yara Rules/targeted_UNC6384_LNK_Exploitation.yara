import "pe"

rule targeted_UNC6384_LNK_Exploitation: extended description {
    meta:
        description = "Detects malicious LNK files exploiting ZDI-CAN-25373 to deploy UNC6384 payloads"
        author = "Arctic Wolf Labs"
        reference = "https://arcticwolf.com/resources/blog/unc6384-weaponizes-zdi-can-25373-vulnerability-to-deploy-plugx/"
        distribution = "TLP:GREEN"
        version = "1.0"
        date = "2025-10-12"
        last_modified = "2025-10-12"

    strings:
        $lnk_header = {4C 00 00 00 01 14 02 00}
        $powershell = "powershell" nocase
        $tar_extract = "tar" nocase
        $cnmpaui = "cnmpaui.exe" nocase
        $temp_path = "$Env:temp" nocase ascii wide
        $readbytes = "ReadAllBytes" nocase

    condition:
        $lnk_header at 0 and
        filesize < 10KB and
        $powershell and
        $tar_extract and
        ($cnmpaui or $temp_path) and
        $readbytes
}
